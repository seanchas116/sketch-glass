{"version":3,"sources":["bundle.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"CanvasController","document","addEventListener","controller","body","appendChild","element","./CanvasController","setimmediate",2,"module","drainQueue","draining","currentQueue","len","queue","noop","process","nextTick","fun","push","setTimeout","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","binding","cwd","chdir","umask",3,"global","undefined","addFromSetImmediateArguments","args","tasksByHandle","nextHandle","partiallyApplied","apply","handler","slice","arguments","Function","runIfPresent","handle","currentlyRunningATask","task","clearImmediate","installNextTickImplementation","setImmediate","canUsePostMessage","postMessage","importScripts","postMessageIsAsynchronous","oldOnMessage","onmessage","installPostMessageImplementation","messagePrefix","Math","random","onGlobalMessage","event","source","data","indexOf","attachEvent","installMessageChannelImplementation","channel","MessageChannel","port1","port2","installReadyStateChangeImplementation","html","doc","documentElement","script","createElement","onreadystatechange","removeChild","installSetTimeoutImplementation","attachTo","Object","getPrototypeOf","toString","this","_process",4,"Background","color","defineProperty","prototype","get","enumerable","configurable",5,"touchPoint","touch","Point","clientX","clientY","InteractionState","Renderer","Color","Transform","interactionState","transform","identity","initialTransform","isStroking","strokeWidth","strokeColor","renderer","background","elem","className","onMouseMove","bind","onMouseDown","onMouseUp","onTouchMove","onTouchStart","onTouchEnd","onWheel","pinchStart","points","pinchStartPoints","pinchMove","scale","sub","centerStart","add","mul","center","diff","merge","translation","updateTransform","update","pinchEnd","pressStart","pos","invert","stroke","currentStroke","newStroke","width","addPoint","addStroke","pressMove","pressEnd","ev","touches","map","preventDefault","translate","deltaX","deltaY","./Background","./Color","./Point","./Renderer","./Transform",6,"g","b","toData","Float32Array",7,"__extends","d","__","constructor","p","hasOwnProperty","Shader","FillShader","_super","gl","vertexShader","fragmentShader","aPosition","getAttribLocation","program","uViewportTransform","getUniformLocation","uSceneTransform","uColor","enableVertexAttribArray","setColor","uniform4fv","setViewportTransform","uniformMatrix3fv","setSceneTransform","./shader",8,"x","y","div","negate","rotate90","normalize","sqrt","floor","ceil","m11","m21","dx","m12","m22","dy","equals","other",9,"Stroke","opts","strokes","isUpdateQueued","devicePixelRatio","height","getContext","antialias","shader","window","onResize","immediate","_this","callback","render","requestAnimationFrame","clearColor","use","viewportTransform","forEach","bindBuffer","ARRAY_BUFFER","buffer","vertexAttribPointer","FLOAT","drawArrays","TRIANGLE_STRIP","polygon","innerWidth","innerHeight","dpr","viewport","console","log","./FillShader","./Stroke",10,"type","createBuffer","point","last","normal","toLeft","toRight","_updatePolygon","bufferData","DYNAMIC_DRAW",11,"det","delta","scaleX","scaleY",12,"_setup","useProgram","_compile","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","warn","getShaderInfoLog","vertexShaderScript","fragmentShaderScript","createProgram","attachShader","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","getProgramParameter","LINK_STATUS"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/// <reference path=\"../typings/bundle.d.ts\" />\n'use strict';\nrequire(\"setimmediate\");\nvar CanvasController = require('./CanvasController');\ndocument.addEventListener('DOMContentLoaded', function () {\n    var controller = new CanvasController();\n    document.body.appendChild(controller.element);\n});\n\n},{\"./CanvasController\":5,\"setimmediate\":3}],2:[function(require,module,exports){\n// shim for using process in browser\n\nvar process = module.exports = {};\nvar queue = [];\nvar draining = false;\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    draining = true;\n    var currentQueue;\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        var i = -1;\n        while (++i < len) {\n            currentQueue[i]();\n        }\n        len = queue.length;\n    }\n    draining = false;\n}\nprocess.nextTick = function (fun) {\n    queue.push(fun);\n    if (!draining) {\n        setTimeout(drainQueue, 0);\n    }\n};\n\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\n// TODO(shtylman)\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n},{}],3:[function(require,module,exports){\n(function (process){\n(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var setImmediate;\n\n    function addFromSetImmediateArguments(args) {\n        tasksByHandle[nextHandle] = partiallyApplied.apply(undefined, args);\n        return nextHandle++;\n    }\n\n    // This function accepts the same arguments as setImmediate, but\n    // returns a function that requires no arguments.\n    function partiallyApplied(handler) {\n        var args = [].slice.call(arguments, 1);\n        return function() {\n            if (typeof handler === \"function\") {\n                handler.apply(undefined, args);\n            } else {\n                (new Function(\"\" + handler))();\n            }\n        };\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(partiallyApplied(runIfPresent, handle), 0);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    task();\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function installNextTickImplementation() {\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            process.nextTick(partiallyApplied(runIfPresent, handle));\n            return handle;\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            global.postMessage(messagePrefix + handle, \"*\");\n            return handle;\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            channel.port2.postMessage(handle);\n            return handle;\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n            return handle;\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            setTimeout(partiallyApplied(runIfPresent, handle), 0);\n            return handle;\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 6â€“8\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(new Function(\"return this\")()));\n\n}).call(this,require('_process'))\n},{\"_process\":2}],4:[function(require,module,exports){\n/// <reference path=\"../typings/bundle.d.ts\" />\n'use strict';\nvar Background = (function () {\n    function Background(color) {\n        this.color = color;\n    }\n    Object.defineProperty(Background.prototype, \"isOpaque\", {\n        get: function () {\n            return this.color.a !== 0;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Background;\n})();\nmodule.exports = Background;\n\n},{}],5:[function(require,module,exports){\n/// <reference path=\"../typings/bundle.d.ts\" />\n'use strict';\nvar Renderer = require('./Renderer');\nvar Point = require('./Point');\nvar Color = require('./Color');\nvar Transform = require('./Transform');\nvar Background = require('./Background');\nfunction touchPoint(touch) {\n    return new Point(touch.clientX, touch.clientY);\n}\nvar InteractionState;\n(function (InteractionState) {\n    InteractionState[InteractionState[\"None\"] = 0] = \"None\";\n    InteractionState[InteractionState[\"Pressed\"] = 1] = \"Pressed\";\n    InteractionState[InteractionState[\"Pinching\"] = 2] = \"Pinching\";\n})(InteractionState || (InteractionState = {}));\nvar CanvasController = (function () {\n    function CanvasController() {\n        this.interactionState = 0 /* None */;\n        this.transform = Transform.identity();\n        this.initialTransform = Transform.identity();\n        this.isStroking = false;\n        this.strokeWidth = 4;\n        this.strokeColor = new Color(0, 0, 0, 1);\n        this.renderer = new Renderer({ background: new Background(new Color(255, 255, 255, 1)) });\n        var elem = this.element = document.createElement('div');\n        elem.className = 'canvas-area';\n        elem.appendChild(this.renderer.element);\n        elem.addEventListener('mousemove', this.onMouseMove.bind(this));\n        elem.addEventListener('mousedown', this.onMouseDown.bind(this));\n        elem.addEventListener('mouseup', this.onMouseUp.bind(this));\n        elem.addEventListener('touchmove', this.onTouchMove.bind(this));\n        elem.addEventListener('touchstart', this.onTouchStart.bind(this));\n        elem.addEventListener('touchend', this.onTouchEnd.bind(this));\n        elem.addEventListener('wheel', this.onWheel.bind(this));\n    }\n    CanvasController.prototype.pinchStart = function (points) {\n        this.interactionState = 2 /* Pinching */;\n        this.pinchStartPoints = points;\n        this.initialTransform = this.transform;\n    };\n    CanvasController.prototype.pinchMove = function (points) {\n        if (this.interactionState !== 2 /* Pinching */) {\n            this.pinchStart(points);\n        }\n        var scale = points[0].sub(points[1]).length / this.pinchStartPoints[0].sub(this.pinchStartPoints[1]).length;\n        var centerStart = this.pinchStartPoints[0].add(this.pinchStartPoints[1]).mul(0.5);\n        var center = points[0].add(points[1]).mul(0.5);\n        var diff = center.sub(centerStart.mul(scale));\n        var transform = Transform.scale(scale, scale).merge(Transform.translation(diff));\n        var transform = this.initialTransform.merge(transform);\n        this.updateTransform(transform);\n        this.renderer.update();\n    };\n    CanvasController.prototype.pinchEnd = function () {\n        this.interactionState = 0 /* None */;\n    };\n    CanvasController.prototype.pressStart = function (pos) {\n        this.interactionState = 1 /* Pressed */;\n        pos = pos.transform(this.transform.invert());\n        var stroke = this.currentStroke = this.renderer.newStroke();\n        stroke.width = this.strokeWidth;\n        stroke.color = this.strokeColor;\n        stroke.addPoint(pos);\n        this.renderer.addStroke(stroke);\n        this.renderer.update(true);\n    };\n    CanvasController.prototype.pressMove = function (pos) {\n        if (this.interactionState === 1 /* Pressed */) {\n            pos = pos.transform(this.transform.invert());\n            this.currentStroke.addPoint(pos);\n            this.renderer.update(true);\n        }\n    };\n    CanvasController.prototype.pressEnd = function () {\n        if (this.interactionState === 1 /* Pressed */) {\n            this.interactionState = 0 /* None */;\n        }\n    };\n    CanvasController.prototype.updateTransform = function (transform) {\n        this.transform = transform;\n        this.renderer.transform = transform;\n    };\n    CanvasController.prototype.onMouseMove = function (ev) {\n        //console.log(`mouse move at ${ev.clientX}, ${ev.clientY}`);\n        this.pressMove(new Point(ev.clientX, ev.clientY));\n    };\n    CanvasController.prototype.onMouseDown = function (ev) {\n        //console.log(`mouse down at ${ev.clientX}, ${ev.clientY}`);\n        this.pressStart(new Point(ev.clientX, ev.clientY));\n    };\n    CanvasController.prototype.onMouseUp = function (ev) {\n        //console.log(`mouse up at ${ev.clientX}, ${ev.clientY}`);\n        this.pressEnd();\n    };\n    CanvasController.prototype.onTouchMove = function (ev) {\n        if (ev.touches.length === 1) {\n            var touch = ev.touches[0];\n            this.pressMove(touchPoint(touch));\n        }\n        else if (ev.touches.length === 2) {\n            this.pinchMove([0, 1].map(function (i) { return touchPoint(ev.touches[i]); }));\n        }\n        ev.preventDefault();\n    };\n    CanvasController.prototype.onTouchStart = function (ev) {\n        if (ev.touches.length === 1) {\n            var touch = ev.touches[0];\n            this.pressStart(touchPoint(touch));\n        }\n        else if (ev.touches.length === 2) {\n            this.pinchStart([0, 1].map(function (i) { return touchPoint(ev.touches[i]); }));\n        }\n        ev.preventDefault();\n    };\n    CanvasController.prototype.onTouchEnd = function (ev) {\n        this.pressEnd();\n        this.pinchEnd();\n        ev.preventDefault();\n    };\n    CanvasController.prototype.onWheel = function (ev) {\n        var transform = this.transform.translate(new Point(-ev.deltaX, -ev.deltaY));\n        this.updateTransform(transform);\n        this.renderer.update();\n        ev.preventDefault();\n    };\n    return CanvasController;\n})();\nmodule.exports = CanvasController;\n\n},{\"./Background\":4,\"./Color\":6,\"./Point\":8,\"./Renderer\":9,\"./Transform\":11}],6:[function(require,module,exports){\n'use strict';\nvar Color = (function () {\n    function Color(r, g, b, a) {\n        this.r = r;\n        this.g = g;\n        this.b = b;\n        this.a = a;\n    }\n    Color.prototype.toString = function () {\n        return \"rgba(\" + this.r + \", \" + this.g + \", \" + this.b + \", \" + this.a + \")\";\n    };\n    Color.prototype.toData = function () {\n        return new Float32Array([this.r, this.g, this.b, this.a]);\n    };\n    return Color;\n})();\nmodule.exports = Color;\n\n},{}],7:[function(require,module,exports){\n'use strict';\nvar __extends = this.__extends || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    __.prototype = b.prototype;\n    d.prototype = new __();\n};\nvar Shader = require('./shader');\nvar FillShader = (function (_super) {\n    __extends(FillShader, _super);\n    function FillShader(gl) {\n        var vertexShader = \"\\n      uniform mat3 uViewportTransform;\\n      uniform mat3 uSceneTransform;\\n      attribute vec2 aPosition;\\n      void main(void) {\\n        vec3 pos = uViewportTransform * uSceneTransform * vec3(aPosition, 1.0);\\n        gl_Position = vec4(pos.xy, 0.0, 1.0);\\n      }\\n    \";\n        var fragmentShader = \"\\n      precision mediump float;\\n      uniform vec4 uColor;\\n      void main(void) {\\n        gl_FragColor = uColor;\\n      }\\n    \";\n        _super.call(this, gl, vertexShader, fragmentShader);\n        this.aPosition = gl.getAttribLocation(this.program, 'aPosition');\n        this.uViewportTransform = gl.getUniformLocation(this.program, 'uViewportTransform');\n        this.uSceneTransform = gl.getUniformLocation(this.program, 'uSceneTransform');\n        this.uColor = gl.getUniformLocation(this.program, 'uColor');\n        gl.enableVertexAttribArray(this.aPosition);\n    }\n    FillShader.prototype.setColor = function (color) {\n        this.gl.uniform4fv(this.uColor, color.toData());\n    };\n    FillShader.prototype.setViewportTransform = function (transform) {\n        this.gl.uniformMatrix3fv(this.uViewportTransform, false, transform.toData());\n    };\n    FillShader.prototype.setSceneTransform = function (transform) {\n        this.gl.uniformMatrix3fv(this.uSceneTransform, false, transform.toData());\n    };\n    return FillShader;\n})(Shader);\nmodule.exports = FillShader;\n\n},{\"./shader\":12}],8:[function(require,module,exports){\n'use strict';\nvar Point = (function () {\n    function Point(x, y) {\n        this.x = x;\n        this.y = y;\n    }\n    Point.prototype.add = function (a) {\n        return new Point(this.x + a.x, this.y + a.y);\n    };\n    Point.prototype.sub = function (a) {\n        return new Point(this.x - a.x, this.y - a.y);\n    };\n    Point.prototype.mul = function (a) {\n        return new Point(this.x * a, this.y * a);\n    };\n    Point.prototype.div = function (a) {\n        return new Point(this.x / a, this.y / a);\n    };\n    Point.prototype.negate = function () {\n        return new Point(-this.x, -this.y);\n    };\n    Point.prototype.rotate90 = function () {\n        return new Point(-this.y, this.x);\n    };\n    Point.prototype.normalize = function () {\n        return this.div(this.length);\n    };\n    Object.defineProperty(Point.prototype, \"length\", {\n        get: function () {\n            return Math.sqrt(this.x * this.x + this.y * this.y);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Point.prototype.floor = function () {\n        return new Point(Math.floor(this.x), Math.floor(this.y));\n    };\n    Point.prototype.ceil = function () {\n        return new Point(Math.ceil(this.x), Math.ceil(this.y));\n    };\n    Point.prototype.transform = function (t) {\n        var x = t.m11 * this.x + t.m21 * this.y + t.dx;\n        var y = t.m12 * this.x + t.m22 * this.y + t.dy;\n        return new Point(x, y);\n    };\n    Point.prototype.toString = function () {\n        return \"Point(\" + this.x + \",\" + this.y + \")\";\n    };\n    Point.prototype.equals = function (other) {\n        return this.x === other.x && this.y === other.y;\n    };\n    return Point;\n})();\nmodule.exports = Point;\n\n},{}],9:[function(require,module,exports){\n/// <reference path=\"../typings/bundle.d.ts\" />\n'use strict';\nvar Point = require('./Point');\nvar Transform = require('./Transform');\nvar Stroke = require('./Stroke');\nvar FillShader = require(\"./FillShader\");\nvar TILE_SIZE = 128;\nvar Renderer = (function () {\n    function Renderer(opts) {\n        this.element = document.createElement('canvas');\n        this.strokes = [];\n        this.isUpdateQueued = false;\n        this.devicePixelRatio = 1;\n        this.width = 0;\n        this.height = 0;\n        this.transform = Transform.identity();\n        var gl = this.gl = this.element.getContext(\"webgl\", { antialias: false });\n        this.shader = new FillShader(gl);\n        this.background = opts.background;\n        this.element.className = 'canvas-area__renderer';\n        window.addEventListener('resize', this.onResize.bind(this));\n        this.onResize();\n    }\n    Renderer.prototype.addStroke = function (stroke) {\n        this.strokes.push(stroke);\n    };\n    Renderer.prototype.newStroke = function () {\n        return new Stroke(this.gl);\n    };\n    Renderer.prototype.update = function (immediate) {\n        var _this = this;\n        if (immediate === void 0) { immediate = false; }\n        if (!this.isUpdateQueued) {\n            this.isUpdateQueued = true;\n            var callback = function () {\n                _this.render();\n                _this.isUpdateQueued = false;\n            };\n            if (immediate) {\n                setImmediate(callback);\n            }\n            else {\n                requestAnimationFrame(callback);\n            }\n        }\n    };\n    Renderer.prototype.render = function () {\n        var _this = this;\n        var gl = this.gl;\n        var shader = this.shader;\n        gl.clearColor(1, 1, 1, 1);\n        shader.use();\n        shader.setViewportTransform(this.viewportTransform);\n        shader.setSceneTransform(this.transform);\n        this.strokes.forEach(function (stroke) {\n            shader.setColor(stroke.color);\n            gl.bindBuffer(gl.ARRAY_BUFFER, stroke.buffer);\n            gl.vertexAttribPointer(_this.shader.aPosition, 2, gl.FLOAT, false, 0, 0);\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, stroke.polygon.length);\n        });\n    };\n    Renderer.prototype.onResize = function () {\n        var width = this.width = window.innerWidth;\n        var height = this.height = window.innerHeight;\n        var dpr = this.devicePixelRatio = window.devicePixelRatio || 1;\n        this.viewportTransform = Transform.scale(2 / width, 2 / height).translate(new Point(-1, -1)).scale(1, -1);\n        this.element.width = width * dpr;\n        this.element.height = height * dpr;\n        this.gl.viewport(0, 0, width * dpr, height * dpr);\n        console.log(\"resized to \" + width + \" * \" + height + \", pixel ratio \" + devicePixelRatio);\n        this.update();\n    };\n    return Renderer;\n})();\nmodule.exports = Renderer;\n\n},{\"./FillShader\":7,\"./Point\":8,\"./Stroke\":10,\"./Transform\":11}],10:[function(require,module,exports){\n'use strict';\nvar Color = require('./Color');\nvar Stroke = (function () {\n    function Stroke(gl) {\n        this.points = [];\n        this.color = new Color(0, 0, 0, 1);\n        this.width = 1;\n        this.type = \"pen\";\n        this.polygon = [];\n        this.gl = gl;\n        this.buffer = gl.createBuffer();\n    }\n    Stroke.prototype.addPoint = function (point) {\n        this.points.push(point);\n        if (this.points.length >= 2) {\n            var last = this.points[this.points.length - 2];\n            var normal = point.sub(last).normalize().rotate90();\n            var toLeft = normal.mul(this.width / 2);\n            var toRight = normal.mul(-this.width / 2);\n            this.polygon.push(last.add(toLeft));\n            this.polygon.push(last.add(toRight));\n            this.polygon.push(point.add(toLeft));\n            this.polygon.push(point.add(toRight));\n        }\n        this._updatePolygon();\n    };\n    Stroke.prototype._updatePolygon = function () {\n        var data = new Float32Array(this.polygon.length * 2);\n        this.polygon.forEach(function (p, i) {\n            data[i * 2] = p.x;\n            data[i * 2 + 1] = p.y;\n        });\n        var gl = this.gl;\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, data, gl.DYNAMIC_DRAW);\n    };\n    return Stroke;\n})();\nmodule.exports = Stroke;\n\n},{\"./Color\":6}],11:[function(require,module,exports){\n'use strict';\nvar Transform = (function () {\n    function Transform(m11, m12, m21, m22, dx, dy) {\n        this.m11 = m11;\n        this.m12 = m12;\n        this.m21 = m21;\n        this.m22 = m22;\n        this.dx = dx;\n        this.dy = dy;\n    }\n    Transform.prototype.merge = function (other) {\n        // other * this\n        // [P u] [Q v]   [PQ Pv + u]\n        // [0 1] [0 1] = [0  1     ]\n        var m11 = other.m11 * this.m11 + other.m21 * this.m12;\n        var m12 = other.m11 * this.m21 + other.m21 * this.m22;\n        var m21 = other.m12 * this.m11 + other.m22 * this.m12;\n        var m22 = other.m12 * this.m21 + other.m22 * this.m22;\n        var dx = other.m11 * this.dx + other.m21 * this.dy + other.dx;\n        var dy = other.m12 * this.dx + other.m22 * this.dy + other.dy;\n        return new Transform(m11, m12, m21, m22, dx, dy);\n    };\n    Transform.prototype.invert = function () {\n        // [P u]^-1   [P^-1 -P^1 * v]\n        // [0 1]    = [0    1       ]\n        var det = this.m11 * this.m22 - this.m12 * this.m21;\n        var m11 = this.m22 / det;\n        var m12 = -this.m12 / det;\n        var m21 = -this.m21 / det;\n        var m22 = this.m11 / det;\n        var dx = -(m11 * this.dx + m21 * this.dy);\n        var dy = -(m12 * this.dx + m22 * this.dy);\n        return new Transform(m11, m12, m21, m22, dx, dy);\n    };\n    Transform.prototype.translate = function (delta) {\n        return new Transform(this.m11, this.m12, this.m21, this.m22, this.dx + delta.x, this.dy + delta.y);\n    };\n    Transform.prototype.scale = function (scaleX, scaleY) {\n        return new Transform(this.m11 * scaleX, this.m12 * scaleX, this.m21 * scaleY, this.m22 * scaleY, this.dx * scaleX, this.dy * scaleY);\n    };\n    Transform.prototype.toData = function () {\n        return new Float32Array([this.m11, this.m12, 0, this.m21, this.m22, 0, this.dx, this.dy, 1]);\n    };\n    Transform.identity = function () {\n        return new Transform(1, 0, 0, 1, 0, 0);\n    };\n    Transform.scale = function (scaleX, scaleY) {\n        return new Transform(scaleX, 0, 0, scaleY, 0, 0);\n    };\n    Transform.translation = function (translation) {\n        return new Transform(1, 0, 0, 1, translation.x, translation.y);\n    };\n    return Transform;\n})();\nmodule.exports = Transform;\n\n},{}],12:[function(require,module,exports){\n/// <reference path=\"../typings/bundle.d.ts\" />\n'use strict';\nvar Shader = (function () {\n    function Shader(gl, vertexShader, fragmentShader) {\n        this.gl = gl;\n        this._setup(vertexShader, fragmentShader);\n    }\n    Shader.prototype.use = function () {\n        this.gl.useProgram(this.program);\n    };\n    Shader.prototype._compile = function (script, type) {\n        var gl = this.gl;\n        var shader = gl.createShader(type);\n        gl.shaderSource(shader, script);\n        gl.compileShader(shader);\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            console.warn(\"An error occurred compiling the shaders\");\n            console.warn(gl.getShaderInfoLog(shader));\n            return null;\n        }\n        return shader;\n    };\n    Shader.prototype._setup = function (vertexShaderScript, fragmentShaderScript) {\n        var gl = this.gl;\n        var program = this.program = gl.createProgram();\n        gl.attachShader(program, this._compile(vertexShaderScript, gl.VERTEX_SHADER));\n        gl.attachShader(program, this._compile(fragmentShaderScript, gl.FRAGMENT_SHADER));\n        gl.linkProgram(program);\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n            console.warn(\"Failed to link shader program\");\n        }\n        gl.useProgram(program);\n    };\n    return Shader;\n})();\nmodule.exports = Shader;\n\n},{}]},{},[1]);\n"],"sourceRoot":"/source/"}