{"version":3,"sources":["bundle.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"CanvasController","document","addEventListener","controller","body","appendChild","element","./CanvasController","setimmediate",2,"module","drainQueue","draining","currentQueue","len","queue","noop","process","nextTick","fun","push","setTimeout","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","binding","cwd","chdir","umask",3,"global","undefined","addFromSetImmediateArguments","args","tasksByHandle","nextHandle","partiallyApplied","apply","handler","slice","arguments","Function","runIfPresent","handle","currentlyRunningATask","task","clearImmediate","installNextTickImplementation","setImmediate","canUsePostMessage","postMessage","importScripts","postMessageIsAsynchronous","oldOnMessage","onmessage","installPostMessageImplementation","messagePrefix","Math","random","onGlobalMessage","event","source","data","indexOf","attachEvent","installMessageChannelImplementation","channel","MessageChannel","port1","port2","installReadyStateChangeImplementation","html","doc","documentElement","script","createElement","onreadystatechange","removeChild","installSetTimeoutImplementation","attachTo","Object","getPrototypeOf","toString","this","_process",4,"Background","color","defineProperty","prototype","get","enumerable","configurable",5,"touchPoint","touch","Point","clientX","clientY","InteractionState","Renderer","Stroke","Color","Transform","interactionState","transform","identity","initialTransform","isStroking","strokeWidth","strokeColor","renderer","tiled","background","currentStrokeRenderer","elem","className","onMouseMove","bind","onMouseDown","onMouseUp","onTouchMove","onTouchStart","onTouchEnd","onWheel","pinchStart","points","_this","pinchStartPoints","requestAnimationFrame","clear","pinchMove","scale","sub","centerStart","add","mul","center","diff","merge","translation","updateTransform","update","pinchEnd","pressStart","pos","invert","stroke","currentStroke","width","addPoint","strokes","addDirtyRect","lastCurveBoundingRect","updateLater","window","pressMove","pressEnd","boundingRect","drawOther","tiles","forEach","tile","isBlank","ev","touches","map","preventDefault","translate","deltaX","deltaY","./Background","./Color","./Point","./Renderer","./Stroke","./Transform",6,"g","b",7,"Rect","Bezier","Curve","start","control1","control2","end","calcBoundingRect","bezier","bbox","x","min","y","max","catmullRom","prev","next","div","bSpline","c0","c1","c2","c3","./Rect","./vendor/bezier",8,"negate","sqrt","floor","ceil","m11","m21","dx","m12","m22","dy","equals","other",9,"union","isEmpty","intersection","empty","outset","offset","p1","p2","fromPoints","boundingIntegerRect","fromMetrics","height",10,"RendererTile","TILE_SIZE","opts","isTiled","isRenderQueued","devicePixelRatio","dirtyRect","_transform","transformToPixel","onResize","set","dirtyWhole","updateTileTransforms","rect","defer","beginRendering","render","otherTile","drawStroke","setRendererTransform","innerWidth","innerHeight","console","log","rebuildTiles","tileSize","dpr","pixelWidth","pixelHeight","tileXCount","tileYCount","tileY","tileHeight","tileX","tileWidth","topLeft","bottomRight","./RendererTile",11,"rendererTransform","renderingRect","style","left","top","opacity","context","getContext","alpha","isOpaque","save","_clearRect","restore","fillStyle","fillRect","clearRect","activate","beginPath","closePath","clip","setTransform","drawImage","strokeRect","count","globalCompositeOperation","composition","lineCap","lineJoin","startPos","arc","PI","fill","lineWidth","strokeStyle","moveTo","curves","curve","bezierCurveTo",12,"finalizedBoundingRect","point","radius","curveAt","./Curve",13,"det","delta",14,"abs","cos","sin","acos","atan2","asin","crt","v","pow","pi","tau","ZERO","z","utils","Tvalues","Cvalues","arcfn","p","derivativeFn","d","sum","ds","de","ts","te","d1","d2","v2","lerp","v1","ret","pointToString","pointsToString","join","copy","obj","JSON","parse","stringify","angle","dot","dx1","dy1","dx2","dy2","cross","m1","m2","lli8","x1","y1","x2","y2","x3","y3","x4","y4","nx","ny","lli4","p3","p4","lli","c","makeline","findbbox","sections","mx","my","MX","MY","mid","size","shapeintersections","s1","bbox1","s2","bbox2","bboxoverlap","intersections","a1","startcap","forward","back","endcap","a2","l1","virtual","l2","iss","intersects","makeshape","bpl","fpl","shape","self","getminmax","list","concat","align","line","tx","ty","roots","order","reduce","filter","u1","pa","pb","pc","pd","q","q2","discriminant","mp3","mp33","cosphi","phi","crtr","t1","sd","droots","b1","b2","dim","dims","expandbox","_bbox","pairiteration","c1b","c2b","threshold","_t1","_t2","cc1","split","cc2","pairs","right","pair","results","PolyBezier","_3d","valueOf","addCurve","idx","coords","step","dimlen","_linear","toSVG","last","dpoints","dpt","j","computedirection","clockwise","derivative","getLUT","steps","compute","mt","mt2","t2","raise","pim","np","k","normal","__normal3","__normal2","r1","r2","q1","m","R","pt","_p","result","span","subsplit","inflections","mfn","sort","values","overlaps","lbbox","tbbox","nv","reduced","simple","n1","n2","segment","pass1","pass2","distanceFn","ov","rc","outline","d3","d4","linearDistanceFunction","tlen","alen","slen","f1","f2","fcurves","bcurves","graduated","reverse","fs","fe","bs","be","ls","le","segments","outlineshapes","shapes","lineIntersects","curveintersects","selfintersects","define"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/// <reference path=\"../typings/bundle.d.ts\" />\n'use strict';\nrequire(\"setimmediate\");\nvar CanvasController = require('./CanvasController');\ndocument.addEventListener('DOMContentLoaded', function () {\n    var controller = new CanvasController();\n    document.body.appendChild(controller.element);\n});\n\n},{\"./CanvasController\":5,\"setimmediate\":3}],2:[function(require,module,exports){\n// shim for using process in browser\n\nvar process = module.exports = {};\nvar queue = [];\nvar draining = false;\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    draining = true;\n    var currentQueue;\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        var i = -1;\n        while (++i < len) {\n            currentQueue[i]();\n        }\n        len = queue.length;\n    }\n    draining = false;\n}\nprocess.nextTick = function (fun) {\n    queue.push(fun);\n    if (!draining) {\n        setTimeout(drainQueue, 0);\n    }\n};\n\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\n// TODO(shtylman)\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n},{}],3:[function(require,module,exports){\n(function (process){\n(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var setImmediate;\n\n    function addFromSetImmediateArguments(args) {\n        tasksByHandle[nextHandle] = partiallyApplied.apply(undefined, args);\n        return nextHandle++;\n    }\n\n    // This function accepts the same arguments as setImmediate, but\n    // returns a function that requires no arguments.\n    function partiallyApplied(handler) {\n        var args = [].slice.call(arguments, 1);\n        return function() {\n            if (typeof handler === \"function\") {\n                handler.apply(undefined, args);\n            } else {\n                (new Function(\"\" + handler))();\n            }\n        };\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(partiallyApplied(runIfPresent, handle), 0);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    task();\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function installNextTickImplementation() {\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            process.nextTick(partiallyApplied(runIfPresent, handle));\n            return handle;\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            global.postMessage(messagePrefix + handle, \"*\");\n            return handle;\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            channel.port2.postMessage(handle);\n            return handle;\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n            return handle;\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            setTimeout(partiallyApplied(runIfPresent, handle), 0);\n            return handle;\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(new Function(\"return this\")()));\n\n}).call(this,require('_process'))\n},{\"_process\":2}],4:[function(require,module,exports){\n/// <reference path=\"../typings/bundle.d.ts\" />\n'use strict';\nvar Background = (function () {\n    function Background(color) {\n        this.color = color;\n    }\n    Object.defineProperty(Background.prototype, \"isOpaque\", {\n        get: function () {\n            return this.color.a !== 0;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Background;\n})();\nmodule.exports = Background;\n\n},{}],5:[function(require,module,exports){\n/// <reference path=\"../typings/bundle.d.ts\" />\n'use strict';\nvar Renderer = require('./Renderer');\nvar Stroke = require('./Stroke');\nvar Point = require('./Point');\nvar Color = require('./Color');\nvar Transform = require('./Transform');\nvar Background = require('./Background');\nfunction touchPoint(touch) {\n    return new Point(touch.clientX, touch.clientY);\n}\nvar InteractionState;\n(function (InteractionState) {\n    InteractionState[InteractionState[\"None\"] = 0] = \"None\";\n    InteractionState[InteractionState[\"Pressed\"] = 1] = \"Pressed\";\n    InteractionState[InteractionState[\"Pinching\"] = 2] = \"Pinching\";\n})(InteractionState || (InteractionState = {}));\nvar CanvasController = (function () {\n    function CanvasController() {\n        this.interactionState = 0 /* None */;\n        this.transform = Transform.identity();\n        this.initialTransform = Transform.identity();\n        this.isStroking = false;\n        this.strokeWidth = 4;\n        this.strokeColor = new Color(0, 0, 0, 1);\n        this.renderer = new Renderer({ tiled: false, background: new Background(new Color(255, 255, 255, 1)) });\n        this.currentStrokeRenderer = new Renderer({ tiled: true, background: new Background(new Color(0, 0, 0, 0)) });\n        var elem = this.element = document.createElement('div');\n        elem.className = 'canvas-area';\n        elem.appendChild(this.renderer.element);\n        elem.appendChild(this.currentStrokeRenderer.element);\n        elem.addEventListener('mousemove', this.onMouseMove.bind(this));\n        elem.addEventListener('mousedown', this.onMouseDown.bind(this));\n        elem.addEventListener('mouseup', this.onMouseUp.bind(this));\n        elem.addEventListener('touchmove', this.onTouchMove.bind(this));\n        elem.addEventListener('touchstart', this.onTouchStart.bind(this));\n        elem.addEventListener('touchend', this.onTouchEnd.bind(this));\n        elem.addEventListener('wheel', this.onWheel.bind(this));\n    }\n    CanvasController.prototype.pinchStart = function (points) {\n        var _this = this;\n        this.interactionState = 2 /* Pinching */;\n        this.pinchStartPoints = points;\n        this.initialTransform = this.transform;\n        requestAnimationFrame(function () {\n            _this.currentStrokeRenderer.clear();\n        });\n    };\n    CanvasController.prototype.pinchMove = function (points) {\n        if (this.interactionState !== 2 /* Pinching */) {\n            this.pinchStart(points);\n        }\n        var scale = points[0].sub(points[1]).length / this.pinchStartPoints[0].sub(this.pinchStartPoints[1]).length;\n        var centerStart = this.pinchStartPoints[0].add(this.pinchStartPoints[1]).mul(0.5);\n        var center = points[0].add(points[1]).mul(0.5);\n        var diff = center.sub(centerStart.mul(scale));\n        var transform = Transform.scale(scale).merge(Transform.translation(diff));\n        var transform = this.initialTransform.merge(transform);\n        this.updateTransform(transform);\n        this.renderer.update();\n    };\n    CanvasController.prototype.pinchEnd = function () {\n        this.interactionState = 0 /* None */;\n    };\n    CanvasController.prototype.pressStart = function (pos) {\n        this.interactionState = 1 /* Pressed */;\n        pos = pos.transform(this.transform.invert());\n        var stroke = this.currentStroke = new Stroke();\n        stroke.width = this.strokeWidth;\n        stroke.color = this.strokeColor;\n        stroke.addPoint(pos);\n        this.currentStrokeRenderer.strokes = [stroke];\n        var renderer = this.currentStrokeRenderer;\n        renderer.addDirtyRect(stroke.lastCurveBoundingRect);\n        renderer.updateLater(setImmediate.bind(window));\n    };\n    CanvasController.prototype.pressMove = function (pos) {\n        if (this.interactionState === 1 /* Pressed */) {\n            pos = pos.transform(this.transform.invert());\n            var stroke = this.currentStroke;\n            var renderer = this.currentStrokeRenderer;\n            renderer.addDirtyRect(stroke.lastCurveBoundingRect);\n            stroke.addPoint(pos);\n            renderer.addDirtyRect(stroke.lastCurveBoundingRect);\n            renderer.updateLater(setImmediate.bind(window));\n        }\n    };\n    CanvasController.prototype.pressEnd = function () {\n        var _this = this;\n        if (this.interactionState === 1 /* Pressed */) {\n            this.renderer.strokes.push(this.currentStroke);\n            requestAnimationFrame(function () {\n                _this.renderer.addDirtyRect(_this.currentStroke.boundingRect);\n                _this.renderer.drawOther(_this.currentStrokeRenderer);\n                _this.currentStrokeRenderer.strokes = [];\n                _this.currentStrokeRenderer.clear();\n                _this.currentStrokeRenderer.tiles.forEach(function (tile) {\n                    tile.isBlank = true;\n                });\n            });\n            this.interactionState = 0 /* None */;\n        }\n    };\n    CanvasController.prototype.updateTransform = function (transform) {\n        this.transform = transform;\n        this.renderer.transform = transform;\n        this.currentStrokeRenderer.transform = transform;\n    };\n    CanvasController.prototype.onMouseMove = function (ev) {\n        //console.log(`mouse move at ${ev.clientX}, ${ev.clientY}`);\n        this.pressMove(new Point(ev.clientX, ev.clientY));\n    };\n    CanvasController.prototype.onMouseDown = function (ev) {\n        //console.log(`mouse down at ${ev.clientX}, ${ev.clientY}`);\n        this.pressStart(new Point(ev.clientX, ev.clientY));\n    };\n    CanvasController.prototype.onMouseUp = function (ev) {\n        //console.log(`mouse up at ${ev.clientX}, ${ev.clientY}`);\n        this.pressEnd();\n    };\n    CanvasController.prototype.onTouchMove = function (ev) {\n        if (ev.touches.length === 1) {\n            var touch = ev.touches[0];\n            this.pressMove(touchPoint(touch));\n        }\n        else if (ev.touches.length === 2) {\n            this.pinchMove([0, 1].map(function (i) { return touchPoint(ev.touches[i]); }));\n        }\n        ev.preventDefault();\n    };\n    CanvasController.prototype.onTouchStart = function (ev) {\n        if (ev.touches.length === 1) {\n            var touch = ev.touches[0];\n            this.pressStart(touchPoint(touch));\n        }\n        else if (ev.touches.length === 2) {\n            this.pinchStart([0, 1].map(function (i) { return touchPoint(ev.touches[i]); }));\n        }\n        ev.preventDefault();\n    };\n    CanvasController.prototype.onTouchEnd = function (ev) {\n        this.pressEnd();\n        this.pinchEnd();\n        ev.preventDefault();\n    };\n    CanvasController.prototype.onWheel = function (ev) {\n        var transform = this.transform.translate(new Point(-ev.deltaX, -ev.deltaY));\n        this.updateTransform(transform);\n        this.renderer.update();\n        ev.preventDefault();\n    };\n    return CanvasController;\n})();\nmodule.exports = CanvasController;\n\n},{\"./Background\":4,\"./Color\":6,\"./Point\":8,\"./Renderer\":10,\"./Stroke\":12,\"./Transform\":13}],6:[function(require,module,exports){\n'use strict';\nvar Color = (function () {\n    function Color(r, g, b, a) {\n        this.r = r;\n        this.g = g;\n        this.b = b;\n        this.a = a;\n    }\n    Color.prototype.toString = function () {\n        return \"rgba(\" + this.r + \", \" + this.g + \", \" + this.b + \", \" + this.a + \")\";\n    };\n    return Color;\n})();\nmodule.exports = Color;\n\n},{}],7:[function(require,module,exports){\n'use strict';\nvar Point = require('./Point');\nvar Rect = require('./Rect');\nvar Bezier = require('./vendor/bezier');\nvar Curve = (function () {\n    function Curve(start, control1, control2, end) {\n        this.start = start;\n        this.control1 = control1;\n        this.control2 = control2;\n        this.end = end;\n        this.boundingRect = this.calcBoundingRect();\n    }\n    Curve.prototype.calcBoundingRect = function () {\n        var bezier = new Bezier([this.start, this.control1, this.control2, this.end]);\n        var bbox = bezier.bbox();\n        return new Rect(new Point(bbox.x.min, bbox.y.min), new Point(bbox.x.max, bbox.y.max));\n    };\n    Curve.catmullRom = function (prev, start, end, next) {\n        return new Curve(start, start.add(end.sub(prev).div(6)), end.sub(next.sub(start).div(6)), end);\n    };\n    Curve.bSpline = function (c0, c1, c2, c3) {\n        return new Curve(c0.add(c1.mul(4)).add(c2).div(6), c1.mul(2).add(c2).div(3), c2.mul(2).add(c1).div(3), c3.add(c2.mul(4)).add(c1).div(6));\n    };\n    return Curve;\n})();\nmodule.exports = Curve;\n\n},{\"./Point\":8,\"./Rect\":9,\"./vendor/bezier\":14}],8:[function(require,module,exports){\n'use strict';\nvar Point = (function () {\n    function Point(x, y) {\n        this.x = x;\n        this.y = y;\n    }\n    Point.prototype.add = function (a) {\n        return new Point(this.x + a.x, this.y + a.y);\n    };\n    Point.prototype.sub = function (a) {\n        return new Point(this.x - a.x, this.y - a.y);\n    };\n    Point.prototype.mul = function (a) {\n        return new Point(this.x * a, this.y * a);\n    };\n    Point.prototype.div = function (a) {\n        return new Point(this.x / a, this.y / a);\n    };\n    Point.prototype.negate = function () {\n        return new Point(-this.x, -this.y);\n    };\n    Object.defineProperty(Point.prototype, \"length\", {\n        get: function () {\n            return Math.sqrt(this.x * this.x + this.y * this.y);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Point.prototype.floor = function () {\n        return new Point(Math.floor(this.x), Math.floor(this.y));\n    };\n    Point.prototype.ceil = function () {\n        return new Point(Math.ceil(this.x), Math.ceil(this.y));\n    };\n    Point.prototype.transform = function (t) {\n        var x = t.m11 * this.x + t.m21 * this.y + t.dx;\n        var y = t.m12 * this.x + t.m22 * this.y + t.dy;\n        return new Point(x, y);\n    };\n    Point.prototype.toString = function () {\n        return \"Point(\" + this.x + \",\" + this.y + \")\";\n    };\n    Point.prototype.equals = function (other) {\n        return this.x === other.x && this.y === other.y;\n    };\n    return Point;\n})();\nmodule.exports = Point;\n\n},{}],9:[function(require,module,exports){\n'use strict';\nvar Point = require('./Point');\nvar Rect = (function () {\n    function Rect(min, max) {\n        this.min = min;\n        this.max = max;\n    }\n    Object.defineProperty(Rect.prototype, \"x\", {\n        get: function () {\n            return this.min.x;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Rect.prototype, \"y\", {\n        get: function () {\n            return this.min.y;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Rect.prototype, \"width\", {\n        get: function () {\n            return this.max.x - this.min.x;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Rect.prototype, \"height\", {\n        get: function () {\n            return this.max.y - this.min.y;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Rect.prototype, \"isEmpty\", {\n        get: function () {\n            return this.max.x < this.min.x || this.max.y < this.min.y;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Rect.prototype.union = function (other) {\n        if (this.isEmpty) {\n            return other;\n        }\n        if (other.isEmpty) {\n            return this;\n        }\n        var min = new Point(Math.min(this.min.x, other.min.x), Math.min(this.min.y, other.min.y));\n        var max = new Point(Math.max(this.max.x, other.max.x), Math.max(this.max.y, other.max.y));\n        return new Rect(min, max);\n    };\n    Rect.prototype.intersection = function (other) {\n        if (this.isEmpty || other.isEmpty) {\n            return Rect.empty;\n        }\n        var min = new Point(Math.max(this.min.x, other.min.x), Math.max(this.min.y, other.min.y));\n        var max = new Point(Math.min(this.max.x, other.max.x), Math.min(this.max.y, other.max.y));\n        return new Rect(min, max);\n    };\n    Rect.prototype.outset = function (offset) {\n        var diff = new Point(offset, offset);\n        return new Rect(this.min.sub(diff), this.max.add(diff));\n    };\n    Rect.prototype.translate = function (offset) {\n        return new Rect(this.min.add(offset), this.max.add(offset));\n    };\n    Rect.prototype.transform = function (transform) {\n        var p1 = this.min.transform(transform);\n        var p2 = this.max.transform(transform);\n        return Rect.fromPoints(p1, p2);\n    };\n    Rect.prototype.boundingIntegerRect = function () {\n        return new Rect(this.min.floor(), this.max.ceil());\n    };\n    Rect.prototype.toString = function () {\n        return \"Rect(\" + this.min + \",\" + this.max + \")\";\n    };\n    Rect.prototype.equals = function (other) {\n        return this.min.equals(other.min) && this.max.equals(other.max);\n    };\n    Rect.fromPoints = function (p1, p2) {\n        var min = new Point(Math.min(p1.x, p2.x), Math.min(p1.y, p2.y));\n        var max = new Point(Math.max(p1.x, p2.x), Math.max(p1.y, p2.y));\n        return new Rect(min, max);\n    };\n    Rect.fromMetrics = function (x, y, width, height) {\n        return new Rect(new Point(x, y), new Point(x + width, y + height));\n    };\n    Object.defineProperty(Rect, \"empty\", {\n        get: function () {\n            return new Rect(new Point(0, 0), new Point(-1, -1));\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Rect;\n})();\nmodule.exports = Rect;\n\n},{\"./Point\":8}],10:[function(require,module,exports){\n/// <reference path=\"../typings/bundle.d.ts\" />\n'use strict';\nvar Point = require('./Point');\nvar Rect = require('./Rect');\nvar Transform = require('./Transform');\nvar RendererTile = require('./RendererTile');\nvar TILE_SIZE = 128;\nvar Renderer = (function () {\n    function Renderer(opts) {\n        this.isTiled = true;\n        this.element = document.createElement('div');\n        this.tiles = [];\n        this.strokes = [];\n        this.isRenderQueued = false;\n        this.devicePixelRatio = 1;\n        this.width = 0;\n        this.height = 0;\n        this.dirtyRect = Rect.empty;\n        this._transform = Transform.identity();\n        this.transformToPixel = Transform.identity();\n        this.isTiled = opts.tiled;\n        this.background = opts.background;\n        this.element.className = 'canvas-area__renderer';\n        window.addEventListener('resize', this.onResize.bind(this));\n        this.onResize();\n    }\n    Object.defineProperty(Renderer.prototype, \"transform\", {\n        get: function () {\n            return this._transform;\n        },\n        set: function (transform) {\n            this._transform = transform;\n            this.transformToPixel = transform.scale(this.devicePixelRatio);\n            this.dirtyWhole();\n            this.updateTileTransforms();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Renderer.prototype.add = function (stroke) {\n        this.strokes.push(stroke);\n    };\n    Renderer.prototype.addDirtyRect = function (rect) {\n        this.dirtyRect = this.dirtyRect.union(rect.transform(this.transformToPixel).boundingIntegerRect());\n    };\n    Renderer.prototype.dirtyWhole = function () {\n        this.dirtyRect = Rect.fromMetrics(0, 0, this.width * this.devicePixelRatio, this.height * this.devicePixelRatio);\n    };\n    Renderer.prototype.updateLater = function (defer) {\n        var _this = this;\n        if (defer === void 0) { defer = requestAnimationFrame.bind(window); }\n        if (!this.isRenderQueued) {\n            this.isRenderQueued = true;\n            defer(function () {\n                _this.update();\n                _this.isRenderQueued = false;\n            });\n        }\n    };\n    Renderer.prototype.update = function () {\n        this.beginRendering();\n        this.render();\n    };\n    Renderer.prototype.clear = function () {\n        this.tiles.forEach(function (tile) {\n            tile.clear();\n        });\n    };\n    Renderer.prototype.beginRendering = function (clear) {\n        var _this = this;\n        if (clear === void 0) { clear = true; }\n        this.tiles.forEach(function (tile) {\n            tile.beginRendering(_this.dirtyRect, clear);\n        });\n        this.dirtyRect = Rect.empty;\n    };\n    Renderer.prototype.drawOther = function (other) {\n        this.beginRendering(false);\n        this.tiles.forEach(function (tile) {\n            other.tiles.forEach(function (otherTile) {\n                tile.drawOther(otherTile);\n            });\n        });\n    };\n    Renderer.prototype.render = function () {\n        var _this = this;\n        this.tiles.forEach(function (tile) {\n            _this.strokes.forEach(function (stroke) {\n                tile.drawStroke(stroke);\n            });\n        });\n    };\n    Renderer.prototype.updateTileTransforms = function () {\n        var _this = this;\n        this.tiles.forEach(function (tile) {\n            tile.setRendererTransform(_this.transformToPixel);\n        });\n    };\n    Renderer.prototype.onResize = function () {\n        var width = this.width = window.innerWidth;\n        var height = this.height = window.innerHeight;\n        var devicePixelRatio = this.devicePixelRatio = window.devicePixelRatio || 1;\n        this.transformToPixel = this.transform.scale(devicePixelRatio);\n        console.log(\"resized to \" + width + \" * \" + height + \", pixel ratio \" + devicePixelRatio);\n        this.rebuildTiles();\n        this.update();\n    };\n    Renderer.prototype.rebuildTiles = function () {\n        var _this = this;\n        var dpr = this.devicePixelRatio;\n        var pixelWidth = this.width * dpr;\n        var pixelHeight = this.height * dpr;\n        var tileSize;\n        if (this.isTiled) {\n            // tile size: the maximum multiple of devicePixelRatio which does not exceed TILE_SIZE\n            var dpr = this.devicePixelRatio;\n            tileSize = Math.floor(TILE_SIZE / dpr) * dpr;\n            while (Math.floor(tileSize) !== tileSize) {\n                tileSize -= dpr;\n            }\n        }\n        else {\n            tileSize = Math.max(pixelWidth, pixelHeight);\n        }\n        var tileXCount = Math.ceil(pixelWidth / tileSize);\n        var tileYCount = Math.ceil(pixelHeight / tileSize);\n        this.tiles.forEach(function (tile) {\n            _this.element.removeChild(tile.element);\n        });\n        this.tiles = [];\n        for (var tileY = 0; tileY < tileYCount; ++tileY) {\n            var tileHeight;\n            if (tileY === tileYCount - 1) {\n                tileHeight = pixelHeight % tileSize;\n                if (tileHeight === 0) {\n                    tileHeight = tileSize;\n                }\n            }\n            else {\n                tileHeight = tileSize;\n            }\n            for (var tileX = 0; tileX < tileXCount; ++tileX) {\n                var tileWidth;\n                if (tileX === tileXCount - 1) {\n                    tileWidth = pixelWidth % tileSize;\n                    if (tileWidth === 0) {\n                        tileWidth = tileSize;\n                    }\n                }\n                else {\n                    tileWidth = tileSize;\n                }\n                var topLeft = new Point(tileX, tileY).mul(tileSize);\n                var bottomRight = topLeft.add(new Point(tileWidth, tileHeight));\n                var tile = new RendererTile(new Rect(topLeft, bottomRight), this.background);\n                this.tiles.push(tile);\n                this.element.appendChild(tile.element);\n            }\n        }\n        this.updateTileTransforms();\n        this.update();\n    };\n    return Renderer;\n})();\nmodule.exports = Renderer;\n\n},{\"./Point\":8,\"./Rect\":9,\"./RendererTile\":11,\"./Transform\":13}],11:[function(require,module,exports){\n/// <reference path=\"../typings/bundle.d.ts\" />\n'use strict';\nvar Rect = require('./Rect');\nvar Transform = require('./Transform');\nvar RendererTile = (function () {\n    function RendererTile(rect, background) {\n        this.rect = Rect.empty;\n        this.rendererTransform = Transform.identity();\n        this.transform = Transform.identity();\n        this.isBlank = true;\n        this.renderingRect = Rect.empty;\n        this.rect = rect;\n        this.background = background;\n        var elem = this.element = document.createElement('canvas');\n        elem.width = rect.width;\n        elem.height = rect.height;\n        var dpr = window.devicePixelRatio || 0;\n        elem.className = 'canvas-area__renderer-tile';\n        var style = elem.style;\n        var styleAny = style;\n        style.left = \"\" + rect.x / dpr + \"px\";\n        style.top = \"\" + rect.y / dpr + \"px\";\n        style.width = \"\" + rect.width / dpr + \"px\";\n        style.height = \"\" + rect.height / dpr + \"px\";\n        style.opacity = '0';\n        this.context = elem.getContext('2d', { alpha: !background.isOpaque });\n        this.context.save();\n        if (background.isOpaque) {\n            this.isBlank = false;\n            this.clear();\n        }\n    }\n    RendererTile.prototype._clearRect = function (rect) {\n        if (this.background.isOpaque) {\n            this.context.restore();\n            this.context.save();\n            this.context.fillStyle = this.background.color.toString();\n            this.context.fillRect(rect.x, rect.y, rect.width, rect.height);\n        }\n        else {\n            this.context.clearRect(rect.x, rect.y, rect.width, rect.height);\n        }\n    };\n    RendererTile.prototype.setRendererTransform = function (transform) {\n        this.rendererTransform = transform;\n        this.transform = transform.translate(this.rect.min.negate());\n    };\n    RendererTile.prototype.clear = function () {\n        if (this.isBlank) {\n            return;\n        }\n        this.context.restore();\n        this.context.save();\n        this._clearRect(Rect.fromMetrics(0, 0, this.rect.width, this.rect.height));\n        this.element.style.opacity = '0';\n        this.isBlank = true;\n    };\n    RendererTile.prototype.activate = function () {\n        this.element.style.opacity = '1';\n        this.isBlank = false;\n    };\n    // clear and clip\n    RendererTile.prototype.beginRendering = function (rect, clear) {\n        if (clear === void 0) { clear = true; }\n        var clearRect = this.rect.intersection(rect);\n        if (clearRect.isEmpty) {\n            this.renderingRect = Rect.empty;\n            return;\n        }\n        var renderingRect = this.renderingRect = clearRect.translate(this.rect.min.negate());\n        var context = this.context;\n        //context.setTransform(1, 0, 0, 1, 0, 0);\n        context.restore();\n        context.save();\n        if (!this.isBlank && clear) {\n            this._clearRect(renderingRect);\n            if (clearRect.equals(this.rect)) {\n                this.isBlank = true;\n            }\n        }\n        context.beginPath();\n        context.rect(renderingRect.x, renderingRect.y, renderingRect.width, renderingRect.height);\n        context.closePath();\n        context.clip();\n    };\n    RendererTile.prototype.drawOther = function (other) {\n        if (other.isBlank) {\n            return;\n        }\n        this.activate();\n        var context = this.context;\n        context.setTransform(1, 0, 0, 1, 0, 0);\n        var offset = other.rect.min.sub(this.rect.min);\n        context.drawImage(other.element, offset.x, offset.y);\n    };\n    RendererTile.prototype.drawStroke = function (stroke) {\n        if (this.renderingRect.isEmpty) {\n            return;\n        }\n        var strokeRect = stroke.boundingRect.transform(this.rendererTransform);\n        if (this.rect.intersection(strokeRect).isEmpty) {\n            return;\n        }\n        this.activate();\n        var count = stroke.points.length;\n        if (count === 0) {\n            return;\n        }\n        var context = this.context;\n        context.globalCompositeOperation = stroke.composition;\n        context.lineCap = 'round';\n        context.lineJoin = 'round';\n        var t = this.transform;\n        context.setTransform(t.m11, t.m12, t.m21, t.m22, t.dx, t.dy);\n        var startPos = stroke.points[0];\n        if (count === 1) {\n            context.fillStyle = stroke.color.toString();\n            context.beginPath();\n            context.arc(startPos.x, startPos.y, stroke.width / 2, 0, Math.PI * 2);\n            context.fill();\n        }\n        if (count > 1) {\n            context.lineWidth = stroke.width;\n            context.strokeStyle = stroke.color.toString();\n            context.beginPath();\n            context.moveTo(startPos.x, startPos.y);\n            stroke.curves.forEach(function (curve) {\n                context.bezierCurveTo(curve.control1.x, curve.control1.y, curve.control2.x, curve.control2.y, curve.end.x, curve.end.y);\n            });\n            context.stroke();\n        }\n    };\n    return RendererTile;\n})();\nmodule.exports = RendererTile;\n\n},{\"./Rect\":9,\"./Transform\":13}],12:[function(require,module,exports){\n'use strict';\nvar Point = require('./Point');\nvar Curve = require('./Curve');\nvar Color = require('./Color');\nvar Rect = require('./Rect');\nvar Stroke = (function () {\n    function Stroke() {\n        this.points = [];\n        this.color = new Color(0, 0, 0, 1);\n        this.composition = 'source-over';\n        this.width = 1;\n        this.curves = [];\n        this.finalizedBoundingRect = Rect.empty;\n        this.lastCurveBoundingRect = Rect.empty;\n    }\n    Object.defineProperty(Stroke.prototype, \"boundingRect\", {\n        get: function () {\n            return this.finalizedBoundingRect.union(this.lastCurveBoundingRect);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Stroke.prototype.addPoint = function (point) {\n        this.points.push(point);\n        var count = this.points.length;\n        if (count === 1) {\n            var radius = this.width * 0.5;\n            var rect = new Rect(point.sub(new Point(radius, radius)), point.add(new Point(radius, radius)));\n            this.finalizedBoundingRect = this.lastCurveBoundingRect = rect;\n        }\n        else {\n            if (count >= 3) {\n                var curve = this.curves[count - 3] = this.curveAt(count - 3);\n                var rect = curve.boundingRect.outset(this.width * 0.5);\n                this.finalizedBoundingRect = this.finalizedBoundingRect.union(rect);\n            }\n            if (count >= 2) {\n                var curve = this.curveAt(count - 2);\n                this.curves.push(curve);\n                this.lastCurveBoundingRect = curve.boundingRect.outset(this.width * 0.5);\n            }\n        }\n    };\n    Stroke.prototype.curveAt = function (i) {\n        var prev = this.points[i - 1];\n        var start = this.points[i];\n        var end = this.points[i + 1];\n        var next = this.points[i + 2];\n        return Curve.bSpline(prev || start, start, end, next || end);\n    };\n    return Stroke;\n})();\nmodule.exports = Stroke;\n\n},{\"./Color\":6,\"./Curve\":7,\"./Point\":8,\"./Rect\":9}],13:[function(require,module,exports){\n'use strict';\nvar Transform = (function () {\n    function Transform(m11, m12, m21, m22, dx, dy) {\n        this.m11 = m11;\n        this.m12 = m12;\n        this.m21 = m21;\n        this.m22 = m22;\n        this.dx = dx;\n        this.dy = dy;\n    }\n    Transform.prototype.merge = function (other) {\n        // other * this\n        // [P u] [Q v]   [PQ Pv + u]\n        // [0 1] [0 1] = [0  1     ]\n        var m11 = other.m11 * this.m11 + other.m21 * this.m12;\n        var m12 = other.m11 * this.m21 + other.m21 * this.m22;\n        var m21 = other.m12 * this.m11 + other.m22 * this.m12;\n        var m22 = other.m12 * this.m21 + other.m22 * this.m22;\n        var dx = other.m11 * this.dx + other.m21 * this.dy + other.dx;\n        var dy = other.m12 * this.dx + other.m22 * this.dy + other.dy;\n        return new Transform(m11, m12, m21, m22, dx, dy);\n    };\n    Transform.prototype.invert = function () {\n        // [P u]^-1   [P^-1 -P^1 * v]\n        // [0 1]    = [0    1       ]\n        var det = this.m11 * this.m22 - this.m12 * this.m21;\n        var m11 = this.m22 / det;\n        var m12 = -this.m12 / det;\n        var m21 = -this.m21 / det;\n        var m22 = this.m11 / det;\n        var dx = -(m11 * this.dx + m21 * this.dy);\n        var dy = -(m12 * this.dx + m22 * this.dy);\n        return new Transform(m11, m12, m21, m22, dx, dy);\n    };\n    Transform.prototype.translate = function (delta) {\n        return new Transform(this.m11, this.m12, this.m21, this.m22, this.dx + delta.x, this.dy + delta.y);\n    };\n    Transform.prototype.scale = function (scale) {\n        return new Transform(this.m11 * scale, this.m12 * scale, this.m21 * scale, this.m22 * scale, this.dx * scale, this.dy * scale);\n    };\n    Transform.identity = function () {\n        return new Transform(1, 0, 0, 1, 0, 0);\n    };\n    Transform.scale = function (scale) {\n        return new Transform(scale, 0, 0, scale, 0, 0);\n    };\n    Transform.translation = function (translation) {\n        return new Transform(1, 0, 0, 1, translation.x, translation.y);\n    };\n    return Transform;\n})();\nmodule.exports = Transform;\n\n},{}],14:[function(require,module,exports){\n/**\n  A javascript Bezier curve library by Pomax.\n\n  Based on http://pomax.github.io/bezierinfo\n  \n  This code is MIT licensed.\n**/\n(function() {\n  \"use strict\";\n\n  // Math functions. I hate the Math namespace with a passion.\n  var abs = Math.abs,\n      min = Math.min,\n      max = Math.max,\n      cos = Math.cos,\n      sin = Math.sin,\n      acos = Math.acos,\n      asin = Math.asin,\n      atan2 = Math.atan2,\n      sqrt = Math.sqrt,\n      crt = function(v) { if(v<0) return -Math.pow(-v,1/3); return Math.pow(v,1/3); },\n      pi = Math.PI,\n      tau = 2*pi;\n\n  // a zero coordinate, which is surprisingly useful\n  var ZERO = {x:0,y:0,z:0};\n\n  // Bezier utility functions\n  var utils = {\n    // Legendre-Gauss abscissae with n=24 (x_i values, defined at i=n as the roots of the nth order Legendre polynomial Pn(x))\n    Tvalues: [\n      -0.0640568928626056260850430826247450385909,\n       0.0640568928626056260850430826247450385909,\n      -0.1911188674736163091586398207570696318404,\n       0.1911188674736163091586398207570696318404,\n      -0.3150426796961633743867932913198102407864,\n       0.3150426796961633743867932913198102407864,\n      -0.4337935076260451384870842319133497124524,\n       0.4337935076260451384870842319133497124524,\n      -0.5454214713888395356583756172183723700107,\n       0.5454214713888395356583756172183723700107,\n      -0.6480936519369755692524957869107476266696,\n       0.6480936519369755692524957869107476266696,\n      -0.7401241915785543642438281030999784255232,\n       0.7401241915785543642438281030999784255232,\n      -0.8200019859739029219539498726697452080761,\n       0.8200019859739029219539498726697452080761,\n      -0.8864155270044010342131543419821967550873,\n       0.8864155270044010342131543419821967550873,\n      -0.9382745520027327585236490017087214496548,\n       0.9382745520027327585236490017087214496548,\n      -0.9747285559713094981983919930081690617411,\n       0.9747285559713094981983919930081690617411,\n      -0.9951872199970213601799974097007368118745,\n       0.9951872199970213601799974097007368118745\n    ],\n\n    // Legendre-Gauss weights with n=24 (w_i values, defined by a function linked to in the Bezier primer article)\n    Cvalues: [\n      0.1279381953467521569740561652246953718517,\n      0.1279381953467521569740561652246953718517,\n      0.1258374563468282961213753825111836887264,\n      0.1258374563468282961213753825111836887264,\n      0.1216704729278033912044631534762624256070,\n      0.1216704729278033912044631534762624256070,\n      0.1155056680537256013533444839067835598622,\n      0.1155056680537256013533444839067835598622,\n      0.1074442701159656347825773424466062227946,\n      0.1074442701159656347825773424466062227946,\n      0.0976186521041138882698806644642471544279,\n      0.0976186521041138882698806644642471544279,\n      0.0861901615319532759171852029837426671850,\n      0.0861901615319532759171852029837426671850,\n      0.0733464814110803057340336152531165181193,\n      0.0733464814110803057340336152531165181193,\n      0.0592985849154367807463677585001085845412,\n      0.0592985849154367807463677585001085845412,\n      0.0442774388174198061686027482113382288593,\n      0.0442774388174198061686027482113382288593,\n      0.0285313886289336631813078159518782864491,\n      0.0285313886289336631813078159518782864491,\n      0.0123412297999871995468056670700372915759,\n      0.0123412297999871995468056670700372915759\n    ],\n    arcfn: function(p, t, derivativeFn) {\n      var d = derivativeFn(t);\n      d = d.x*d.x + d.y*d.y;\n      if(typeof d.z !== \"undefined\") {\n        d += d.z*d.z;\n      }\n      return sqrt(d);\n    },\n    length: function(p, derivativeFn) {\n      var z=0.5,sum=0,len=this.Tvalues.length,i,t;\n      for(i=0; i<len; i++) {\n        t = z * this.Tvalues[i] + z;\n        sum += this.Cvalues[i] * this.arcfn(p,t,derivativeFn);\n      }\n      return z * sum;\n    },\n    map: function(v, ds,de, ts,te) {\n      var d1 = de-ds, d2 = te-ts, v2 =  v-ds, r = v2/d1;\n      return ts + d2*r;\n    },\n    lerp: function(r, v1, v2) {\n      var ret = {\n        x: v1.x + r*(v2.x-v1.x),\n        y: v1.y + r*(v2.y-v1.y)\n      };\n      if(!!v1.z && !!v2.z) {\n        ret.z =  v1.z + r*(v2.z-v1.z);\n      }\n      return ret;\n    },\n    pointToString: function(p) {\n      var s = p.x+\"/\"+p.y;\n      if(typeof p.z !== \"undefined\") {\n        s += \"/\"+p.z;\n      }\n      return s;\n    },\n    pointsToString: function(points) {\n      return \"[\" + points.map(this.pointToString).join(\", \") + \"]\";\n    },\n    copy: function(obj) {\n      return JSON.parse(JSON.stringify(obj));\n    },\n    angle: function(o,v1,v2) {\n      var dx1 = v1.x - o.x,\n          dy1 = v1.y - o.y,\n          dx2 = v2.x - o.x,\n          dy2 = v2.y - o.y,\n          cross = dx1*dy2 - dy1*dx2,\n          m1 = sqrt(dx1*dx1+dy1*dy1),\n          m2 = sqrt(dx2*dx2+dy2*dy2),\n          dot;\n      dx1/=m1; dy1/=m1; dx2/=m2; dy2/=m2;\n      dot = dx1*dx2 + dy1*dy2;\n      return atan2(cross, dot);\n    },\n    lli8: function(x1,y1,x2,y2,x3,y3,x4,y4) {\n      var nx=(x1*y2-y1*x2)*(x3-x4)-(x1-x2)*(x3*y4-y3*x4),\n          ny=(x1*y2-y1*x2)*(y3-y4)-(y1-y2)*(x3*y4-y3*x4),\n          d=(x1-x2)*(y3-y4)-(y1-y2)*(x3-x4);\n      if(d==0) { return false; }\n      return { x: nx/d, y: ny/d };\n    },\n    lli4: function(p1,p2,p3,p4) {\n      var x1 = p1.x, y1 = p1.y,\n          x2 = p2.x, y2 = p2.y,\n          x3 = p3.x, y3 = p3.y,\n          x4 = p4.x, y4 = p4.y;\n      return this.lli8(x1,y1,x2,y2,x3,y3,x4,y4);\n    },\n    lli: function(v1, v2) {\n      return this.lli4(v1,v1.c,v2,v2.c);\n    },\n    makeline: function(p1,p2) {\n      var x1 = p1.x, y1 = p1.y, x2 = p2.x, y2 = p2.y, dx = (x2-x1)/3, dy = (y2-y1)/3;\n      return new Bezier(x1, y1, x1+dx, y1+dy, x1+2*dx, y1+2*dy, x2, y2);\n    },\n    findbbox: function(sections) {\n      var mx=99999999,my=mx,MX=-mx,MY=MX;\n      sections.forEach(function(s) {\n        var bbox = s.bbox();\n        if(mx > bbox.x.min) mx = bbox.x.min;\n        if(my > bbox.y.min) my = bbox.y.min;\n        if(MX < bbox.x.max) MX = bbox.x.max;\n        if(MY < bbox.y.max) MY = bbox.y.max;\n      });\n      return {\n        x: { min: mx, mid:(mx+MX)/2, max: MX, size:MX-mx },\n        y: { min: my, mid:(my+MY)/2, max: MY, size:MY-my }\n      }\n    },\n    shapeintersections: function(s1, bbox1, s2, bbox2) {\n      if(!this.bboxoverlap(bbox1, bbox2)) return [];\n      var intersections = [];\n      var a1 = [s1.startcap, s1.forward, s1.back, s1.endcap];\n      var a2 = [s2.startcap, s2.forward, s2.back, s2.endcap];\n      a1.forEach(function(l1) {\n        if(l1.virtual) return;\n        a2.forEach(function(l2) {\n          if(l2.virtual) return;\n          var iss = l1.intersects(l2);\n          if(iss.length>0) {\n            iss.c1 = l1;\n            iss.c2 = l2;\n            iss.s1 = s1;\n            iss.s2 = s2;\n            intersections.push(iss);\n          }\n        });\n      });\n      return intersections;\n    },\n    makeshape: function(forward, back) {\n      var bpl = back.points.length;\n      var fpl = forward.points.length;\n      var start  = this.makeline(back.points[bpl-1], forward.points[0]);\n      var end    = this.makeline(forward.points[fpl-1], back.points[0]);\n      var shape  = {\n        startcap: start,\n        forward: forward,\n        back: back,\n        endcap: end,\n        bbox: this.findbbox([start, forward, back, end])\n      };\n      var self = this;\n      shape.intersections = function(s2) {\n        return self.shapeintersections(shape,shape.bbox,s2,s2.bbox);\n      };\n      return shape;\n    },\n    getminmax: function(curve, d, list) {\n      if(!list) return { min:0, max:0 };\n      var min=0xFFFFFFFFFFFFFFFF, max=-min,t,c;\n      if(list.indexOf(0)===-1) { list = [0].concat(list); }\n      if(list.indexOf(1)===-1) { list.push(1); }\n      for(var i=0,len=list.length; i<len; i++) {\n        t = list[i];\n        c = curve.get(t);\n        if(c[d] < min) { min = c[d]; }\n        if(c[d] > max) { max = c[d]; }\n      }\n      return { min:min, mid:(min+max)/2, max:max, size:max-min };\n    },\n    align: function(points, line) {\n      var tx = line.p1.x,\n          ty = line.p1.y,\n          a = -atan2(line.p2.y-ty, line.p2.x-tx),\n          d = function(v) {\n            return {\n              x: (v.x-tx)*cos(a) - (v.y-ty)*sin(a),\n              y: (v.x-tx)*sin(a) + (v.y-ty)*cos(a)\n            };\n          };\n      return points.map(d);\n    },\n    roots: function(points, line) {\n      line = line || {p1:{x:0,y:0},p2:{x:1,y:0}};\n      var order = points.length - 1;\n      var p = this.align(points, line);\n      var reduce = function(t) { return 0<=t && t <=1; };\n\n      if (order === 2) {\n        var a = p[0].y,\n            b = p[1].y,\n            c = p[2].y,\n            d = a - 2*b + c;\n        if(d!==0) {\n          var m1 = -sqrt(b*b-a*c),\n              m2 = -a+b,\n              v1 = -( m1+m2)/d,\n              v2 = -(-m1+m2)/d;\n          return [v1, v2].filter(reduce);\n        }\n        else if(b!==c && d===0) {\n          return [ (2*b-c)/2*(b-c) ].filter(reduce);\n        }\n        return [];\n      }\n\n      // see http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm\n      var pa = p[0].y,\n          pb = p[1].y,\n          pc = p[2].y,\n          pd = p[3].y,\n          d = (-pa + 3*pb - 3*pc + pd),\n          a = (3*pa - 6*pb + 3*pc) / d,\n          b = (-3*pa + 3*pb) / d,\n          c = pa / d,\n          p = (3*b - a*a)/3,\n          p3 = p/3,\n          q = (2*a*a*a - 9*a*b + 27*c)/27,\n          q2 = q/2,\n          discriminant = q2*q2 + p3*p3*p3,\n          u1,v1,x1,x2,x3;\n       if (discriminant < 0) {\n        var mp3 = -p/3,\n            mp33 = mp3*mp3*mp3,\n            r = sqrt( mp33 ),\n            t = -q/(2*r),\n            cosphi = t<-1 ? -1 : t>1 ? 1 : t,\n            phi = acos(cosphi),\n            crtr = crt(r),\n            t1 = 2*crtr;\n        x1 = t1 * cos(phi/3) - a/3;\n        x2 = t1 * cos((phi+tau)/3) - a/3;\n        x3 = t1 * cos((phi+2*tau)/3) - a/3;\n        return [x1, x2, x3].filter(reduce);\n      } else if(discriminant === 0) {\n        u1 = q2 < 0 ? crt(-q2) : -crt(q2);\n        x1 = 2*u1-a/3;\n        x2 = -u1 - a/3;\n        return [x1,x2].filter(reduce);\n      } else {\n        var sd = sqrt(discriminant);\n        u1 = crt(-q2+sd);\n        v1 = crt(q2+sd);\n        return [u1-v1-a/3].filter(reduce);;\n      }\n    },\n    droots: function(p) {\n      // quadratic roots are easy\n      if(p.length === 3) {\n        var a = p[0],\n            b = p[1],\n            c = p[2],\n            d = a - 2*b + c;\n        if(d!==0) {\n          var m1 = -sqrt(b*b-a*c),\n              m2 = -a+b,\n              v1 = -( m1+m2)/d,\n              v2 = -(-m1+m2)/d;\n          return [v1, v2];\n        }\n        else if(b!==c && d===0) {\n          return [ (2*b-c)/(2*(b-c)) ];\n        }\n        return [];\n      }\n\n      // linear roots are even easier\n      if(p.length === 2) {\n        var a = p[0], b = p[1];\n        if(a!==b) { return [a/(a-b)]; }\n        return [];\n      }\n    },\n    bboxoverlap: function(b1,b2) {\n      var dims=['x','y'],len=dims.length,i,dim,l,t,d\n      for(i=0; i<len; i++) {\n        dim = dims[i];\n        l = b1[dim].mid;\n        t = b2[dim].mid;\n        d = (b1[dim].size + b2[dim].size)/2;\n        if(abs(l-t) >= d) return false;\n      }\n      return true;\n    },\n    expandbox: function(bbox, _bbox) {\n      if(_bbox.x.min < bbox.x.min) { bbox.x.min = _bbox.x.min; }\n      if(_bbox.y.min < bbox.y.min) { bbox.y.min = _bbox.y.min; }\n      if(_bbox.z && _bbox.z.min < bbox.z.min) { bbox.z.min = _bbox.z.min; }\n      if(_bbox.x.max > bbox.x.max) { bbox.x.max = _bbox.x.max; }\n      if(_bbox.y.max > bbox.y.max) { bbox.y.max = _bbox.y.max; }\n      if(_bbox.z && _bbox.z.max > bbox.z.max) { bbox.z.max = _bbox.z.max; }\n      bbox.x.mid = (bbox.x.min + bbox.x.max)/2;\n      bbox.y.mid = (bbox.y.min + bbox.y.max)/2;\n      if(bbox.z) { bbox.z.mid = (bbox.z.min + bbox.z.max)/2; }\n      bbox.x.size = bbox.x.max - bbox.x.min;\n      bbox.y.size = bbox.y.max - bbox.y.min;\n      if(bbox.z) { bbox.z.size = bbox.z.max - bbox.z.min; }\n    },\n    pairiteration: function(c1,c2) {\n      var c1b = c1.bbox(),\n          c2b = c2.bbox(),\n          r = 100000,\n          threshold = 0.5;\n      if(c1b.x.size + c1b.y.size < threshold && c2b.x.size + c2b.y.size < threshold) {\n        return [ ((r * (c1._t1+c1._t2)/2)|0)/r + \"/\" + ((r * (c2._t1+c2._t2)/2)|0)/r ];\n      }\n      var cc1 = c1.split(0.5),\n          cc2 = c2.split(0.5),\n          pairs = [\n            {left: cc1.left, right: cc2.left },\n            {left: cc1.left, right: cc2.right },\n            {left: cc1.right, right: cc2.right },\n            {left: cc1.right, right: cc2.left }];\n      pairs = pairs.filter(function(pair) {\n        return utils.bboxoverlap(pair.left.bbox(),pair.right.bbox());\n      });\n      var results = [];\n      if(pairs.length === 0) return results;\n      pairs.forEach(function(pair) {\n        results = results.concat(\n          utils.pairiteration(pair.left, pair.right)\n        );\n      })\n      results = results.filter(function(v,i) {\n        return results.indexOf(v) === i;\n      });\n      return results;\n    }\n  };\n\n  var PolyBezier = function(curves) {\n    this.curves = [];\n    this._3d = false;\n    if(!!curves) {\n      this.curves = curves;\n      this._3d = this.curves[0]._3d;\n    }\n  }\n\n  PolyBezier.prototype = {\n    valueOf: function() {\n      return this.toString();\n    },\n    toString: function() {\n      return utils.pointsToString(this.points);\n    },\n    addCurve: function(curve) {\n      this.curves.push(curve);\n      this._3d = this._3d || curve._3d;\n    },\n    length: function() {\n      return this.curves.map(function(v) { return v.length(); }).reduce(function(a,b) { return a+b; });\n    },\n    curve: function(idx) {\n      return this.curves[idx];\n    },\n    bbox: function() {\n      var c = this.curves;\n      var bbox = c[0].bbox();\n      for(var i=1; i<c.length; i++) {\n        utils.expandbox(bbox, c[i].bbox());\n      }\n      return bbox;\n    },\n    offset: function(d) {\n      var offset = [];\n      this.curves.forEach(function(v) {\n        offset = offset.concat(v.offset(d));\n      });\n      return new PolyBezier(offset);\n    },\n  };\n\n  /**\n   * Bezier curve constructor. The constructor argument can be one of three things:\n   *\n   * 1. array/4 of {x:..., y:..., z:...}, z optional\n   * 2. numerical array/8 ordered x1,y1,x2,y2,x3,y3,x4,y4\n   * 3. numerical array/12 ordered x1,y1,z1,x2,y2,z2,x3,y3,z3,x4,y4,z4\n   *\n   */\n  var Bezier = function(coords) {\n    var args = (coords && coords.forEach ? coords : arguments);\n    if(typeof args[0] === \"object\") {\n      args = [];\n      for(var i=0; i<coords.length; i++) {\n        ['x','y','z'].forEach(function(d) {\n          if(typeof coords[i][d] !== \"undefined\") {\n            args.push(coords[i][d]);\n          }\n        });\n      }\n    }\n    var len = args.length;\n    if(len!==6 && len!==8 && len!==9 && len!==12) {\n      throw new Error(\"This Bezier curve library only supports quadratic and cubic curves (in 2d and 3d)\");\n    }\n    var _3d = (len === 9 || len === 12);\n    this._3d = _3d;\n    var points = [];\n    for(var idx=0, step=(_3d ? 3 : 2); idx<len; idx+=step) {\n      var point = {\n        x: args[idx],\n        y: args[idx+1]\n      };\n      if(_3d) { point.z = args[idx+2] };\n      points.push(point);\n    }\n    this.order = points.length - 1;\n    this.points = points;\n    var dims = ['x','y'];\n    if(_3d) dims.push('z');\n    this.dims = dims;\n    this.dimlen = dims.length;\n    (function(curve) {\n      var a = utils.align(points, {p1:points[0], p2:points[curve.order]});\n      for(var i=0; i<a.length; i++) {\n        if(abs(a[i].y) > 0.0001) {\n          curve._linear = false;\n          return;\n        }\n      }\n      curve._linear = true;\n    }(this));\n    this._t1 = 0;\n    this._t2 = 1;\n    this.update();\n  };\n\n  Bezier.utils = utils;\n\n  Bezier.prototype = {\n    valueOf: function() {\n      return this.toString();\n    },\n    toString: function() {\n      return utils.pointsToString(this.points);\n    },\n    toSVG: function(relative) {\n      if(this._3d) return false;\n      var p = this.points,\n          x = p[0].x,\n          y = p[0].y,\n          s = \"M \"+x+\" \"+y+\" \"+(this.order===2 ? \"Q \":\"C \");\n      for(var i=1, last=p.length; i<last; i++) { s += p[i].x+\" \"+p[i].y; }\n      return s;\n    },\n    update: function() {\n      // one-time compute derivative coordinates\n      this.dpoints = [];\n      for(var p=this.points, d=p.length, c=d-1; d>1; d--, c--) {\n        var list = [];\n        for(var j=0, dpt; j<c; j++) {\n          dpt = {\n            x: c * (p[j+1].x - p[j].x),\n            y: c * (p[j+1].y - p[j].y)\n          };\n          if(this._3d) {\n            dpt.z = c * (p[j+1].z - p[j].z);\n          }\n          list.push(dpt);\n        }\n        this.dpoints.push(list);\n        p = list;\n      };\n      this.computedirection();\n    },\n    computedirection: function() {\n      var points = this.points;\n      var angle = utils.angle(points[0], points[this.order], points[1]);\n      this.clockwise = angle > 0;\n    },\n    length: function() {\n      return utils.length(this.points, this.derivative.bind(this));\n    },\n    getLUT: function(steps) {\n      steps = steps || 100;\n      var points = [];\n      for(var t=0; t<=steps; t++) {\n        points.push(this.compute(t/steps));\n      }\n      return points;\n    },\n    get: function(t) {\n      return this.compute(t);\n    },\n    point: function(idx) {\n      return this.points[idx];\n    },\n    compute: function(t) {\n      // shortcuts\n      if(t===0) { return this.points[0]; }\n      if(t===1) { return this.points[this.order]; }\n      // plain computation\n      var mt = 1-t,\n          mt2 = mt*mt,\n          t2 = t*t,\n          a,b,c,d = 0,\n          p = this.points;\n      if(this.order===2) {\n        p = [p[0], p[1], p[2], ZERO];\n        a = mt2;\n        b = mt*t*2;\n        c = t2;\n      }\n      if(this.order===3) {\n        a = mt2*mt;\n        b = mt2*t*3;\n        c = mt*t2*3;\n        d = t*t2;\n      }\n      var ret = {\n        x: a*p[0].x + b*p[1].x + c*p[2].x + d*p[3].x,\n        y: a*p[0].y + b*p[1].y + c*p[2].y + d*p[3].y\n      };\n      if(this._3d) {\n        ret.z = a*p[0].z + b*p[1].z + c*p[2].z + d*p[3].z;\n      }\n      return ret;\n    },\n    raise: function() {\n      var p = this.points, np = [p[0]], i, k=p.length, pi, pim;\n      for (var i=1; i<k; i++) {\n        pi = p[i];\n        pim = p[i-1];\n        np[i] = {\n          x: (k-i)/k * pi.x + i/k * pim.x,\n          y: (k-i)/k * pi.y + i/k * pim.y\n        };\n      }\n      np[k] = p[k-1];\n      return new Bezier(np);\n    },\n    derivative: function(t) {\n      var mt = 1-t,\n          a,b,c=0,\n          p = this.dpoints[0];\n      if(this.order===2) { p = [p[0], p[1], ZERO]; a = mt; b = t; }\n      if(this.order===3) { a = mt*mt; b = mt*t*2; c = t*t; }\n      var ret = {\n        x: a*p[0].x + b*p[1].x + c*p[2].x,\n        y: a*p[0].y + b*p[1].y + c*p[2].y\n      };\n      if(this._3d) {\n        ret.z = a*p[0].z + b*p[1].z + c*p[2].z;\n      }\n      return ret;\n    },\n    normal: function(t) {\n      return this._3d ? this.__normal3(t) : this.__normal2(t);\n    },\n    __normal2: function(t) {\n      var d = this.derivative(t);\n      var q = sqrt(d.x*d.x + d.y*d.y)\n      return { x: -d.y/q, y: d.x/q };\n    },\n    __normal3: function() {\n      // see http://stackoverflow.com/questions/25453159\n      var r1 = this.derivative(t),\n          r2 = this.derivative(t+0.01),\n          q1 = sqrt(r1.x*r1.x + r1.y*r1.y + r1.z*r1.z),\n          q2 = sqrt(r2.x*r2.x + r2.y*r2.y + r2.z*r2.z);\n      r1.x /= q1; r1.y /= q1; r1.z /= q1;\n      r2.x /= q2; r2.y /= q2; r2.z /= q2;\n      // cross product\n      var c = {\n        x: r2.y*r1.z - r2.z*r1.y,\n        y: r2.z*r1.x - r2.x*r1.z,\n        z: r2.x*r1.y - r2.y*r1.x\n      };\n      var m = sqrt(c.x*c.x + c.y*c.y + c.z*c.z);\n      c.x /= m; c.y /= m; c.z /= m;\n      // rotation matrix\n      var R = [   c.x*c.x,   c.x*c.y-c.z, c.x*c.z+c.y,\n                c.x*c.y+c.z,   c.y*c.y,   c.y*c.z-c.x,\n                c.x*c.z-c.y, c.y*c.z+c.x,   c.z*c.z    ];\n      // normal vector:\n      var n = {\n        x: R[0] * r1.x + R[1] * r1.y + R[2] * r1.z,\n        y: R[3] * r1.x + R[4] * r1.y + R[5] * r1.z,\n        z: R[6] * r1.x + R[7] * r1.y + R[8] * r1.z\n      };\n      return n;\n    },\n    split: function(t1, t2) {\n      // shortcuts\n      if(t1===0 && !!t2) { return this.split(t2).left; }\n      if(t2===1) { return this.split(t1).right; }\n      // no shortcut: use \"de Casteljau\" iteration.\n      var p = this.points,\n          _p = [],\n          pt,\n          q = [],\n          idx = 0,\n          i=0,\n          l=0;\n      q[idx++] = p[0];\n      q[idx++] = p[1];\n      q[idx++] = p[2];\n      if(this.order === 3) { q[idx++] = p[3]; }\n      // we lerp between all points at each iteration, until we have 1 point left.\n      while(p.length>1) {\n        _p = [];\n        for(i=0, l=p.length-1; i<l; i++) {\n          pt = utils.lerp(t1,p[i],p[i+1]);\n          q[idx++] = pt;\n          _p.push(pt);\n        }\n        p = _p;\n      }\n      var result = {\n        left: this.order === 2 ? new Bezier([q[0],q[3],q[5]]) : new Bezier([q[0],q[4],q[7],q[9]]),\n        right: this.order === 2 ? new Bezier([q[5],q[4],q[2]]) : new Bezier([q[9],q[8],q[6],q[3]]),\n        span: q\n      };\n\n      // make sure we bind _t1/_t2 information!\n      result.left._t1  = utils.map(0,  0,1, this._t1,this._t2);\n      result.left._t2  = utils.map(t1, 0,1, this._t1,this._t2);\n      result.right._t1 = utils.map(t1, 0,1, this._t1,this._t2);\n      result.right._t2 = utils.map(1,  0,1, this._t1,this._t2);\n\n      // if we have no t2, we're done\n      if(!t2) { return result; }\n\n      // if we have a t2, split again:\n      t2 = utils.map(t2,t1,1,0,1);\n      var subsplit = result.right.split(t2);\n      return subsplit.left;\n    },\n    inflections: function() {\n      var dims = this.dims,\n          len = this.dimlen,\n          result={},\n          roots=[],\n          p, mfn;\n      dims.forEach(function(dim) {\n        mfn = function(v) { return v[dim]; };\n        p = this.dpoints[0].map(mfn);\n        result[dim] = utils.droots(p);\n        if(this.order === 3) {\n          p = this.dpoints[1].map(mfn);\n          result[dim] = result[dim].concat(utils.droots(p));\n        }\n        result[dim] = result[dim].filter(function(t) { return (t>=0 && t<=1); });\n        roots = roots.concat(result[dim].sort());\n      }.bind(this));\n      roots.sort();\n      result.values = roots;\n      return result;\n    },\n    bbox: function() {\n      var inflections = this.inflections(), result = {};\n      this.dims.forEach(function(d) {\n        result[d] = utils.getminmax(this, d, inflections[d]);\n      }.bind(this));\n      return result;\n    },\n    overlaps: function(curve) {\n      var lbbox = this.bbox(),\n          tbbox = curve.bbox();\n      return utils.bboxoverlap(lbbox,tbbox);\n    },\n    offset: function(t, d) {\n      if(typeof d !== \"undefined\") {\n        var c = this.get(t);\n        var n = this.normal(t);\n        var ret = {\n          c: c,\n          n: n,\n          x: c.x + n.x * d,\n          y: c.y + n.y * d\n        };\n        if(this._3d) {\n          ret.z = c.z + n.z * d;\n        };\n        return ret;\n      }\n      if(this._linear) {\n        var nv = this.normal(0);\n        var coords = this.points.map(function(p) {\n          var ret = {\n            x: p.x + t * nv.x,\n            y: p.y + t * nv.y\n          };\n          if(p.z && n.z) { ret.z = p.z + t * nv.z; }\n          return ret;\n        });\n        return [new Bezier(coords)];\n      }\n      var reduced = this.reduce();\n      return reduced.map(function(s) {\n        return s.scale(t);\n      });\n    },\n    simple: function() {\n      if(this.order===3) {\n        var a1 = utils.angle(this.points[0], this.points[3], this.points[1]);\n        var a2 = utils.angle(this.points[0], this.points[3], this.points[2]);\n        if(a1>0 && a2<0 || a1<0 && a2>0) return false;\n      }\n      var n1 = this.normal(0);\n      var n2 = this.normal(1);\n      var s = n1.x*n2.x + n1.y*n2.y;\n      if(this._3d) { s += n1.z*n2.z; }\n      var angle = abs(acos(s));\n      return angle < pi/3;\n    },\n    reduce: function() {\n      var i, t1=0, t2=0, step=0.01, segment, pass1=[], pass2=[];\n      // first pass: split on inflections\n      var inflections = this.inflections().values;\n      if(inflections.indexOf(0)===-1) { inflections = [0].concat(inflections); }\n      if(inflections.indexOf(1)===-1) { inflections.push(1); }\n      for(t1=inflections[0], i=1; i<inflections.length; i++) {\n        t2 = inflections[i];\n        segment = this.split(t1,t2);\n        segment._t1 = t1;\n        segment._t2 = t2;\n        pass1.push(segment);\n        t1 = t2;\n      }\n      // second pass: further reduce these segments to simple segments\n      pass1.forEach(function(p1) {\n        t1=0;\n        t2=0;\n        while(t2 <= 1) {\n          for(t2=t1+step; t2<=1+step; t2+=step) {\n            segment = p1.split(t1,t2);\n            if(!segment.simple()) {\n              t2 -= step;\n              if(abs(t1-t2)<step) {\n                // we can never form a reduction\n                return [];\n              }\n              segment = p1.split(t1,t2);\n              segment._t1 = utils.map(t1,0,1,p1._t1,p1._t2);\n              segment._t2 = utils.map(t2,0,1,p1._t1,p1._t2);\n              pass2.push(segment);\n              t1 = t2;\n              break;\n            }\n          }\n        }\n        if(t1<1) {\n          segment = p1.split(t1,1);\n          segment._t1 = utils.map(t1,0,1,p1._t1,p1._t2);\n          segment._t2 = p1._t2;\n          pass2.push(segment);\n        }\n      });\n      return pass2;\n    },\n    scale: function(d) {\n      var order = this.order;\n      var distanceFn = false\n      if(typeof d === \"function\") { distanceFn = d; }\n      if(distanceFn && order === 2) { return this.raise().scale(distanceFn); }\n\n      // TODO: add special handling for degenerate (=linear) curves.\n      var clockwise = this.clockwise;\n      var r1 = distanceFn ? distanceFn(0) : d;\n      var r2 = distanceFn ? distanceFn(1) : d;\n      var v = [ this.offset(0,10), this.offset(1,10) ];\n      var o = utils.lli4(v[0], v[0].c, v[1], v[1].c);\n      if(!o) { throw \"cannot scale this curve. Try reducing it first.\"; }\n      // move all points by distance 'd' wrt the origin 'o'\n      var points=this.points, np=[];\n\n      // move end points by fixed distance along normal.\n      [0,1].forEach(function(t) {\n        var p = np[t*order] = utils.copy(points[t*order]);\n        p.x += (t?r2:r1) * v[t].n.x;\n        p.y += (t?r2:r1) * v[t].n.y;\n      }.bind(this));\n\n      if (!distanceFn) {\n        // move control points to lie on the intersection of the offset\n        // derivative vector, and the origin-through-control vector\n        [0,1].forEach(function(t) {\n          if(this.order===2 && !!t) return;\n          var p = np[t*order];\n          var d = this.derivative(t);\n          var p2 = { x: p.x + d.x, y: p.y + d.y };\n          np[t+1] = utils.lli4(p, p2, o, points[t+1]);\n        }.bind(this));\n        return new Bezier(np);\n      }\n\n      // move control points by \"however much necessary to\n      // ensure the correct tangent to endpoint\".\n      [0,1].forEach(function(t) {\n        if(this.order===2 && !!t) return;\n        var p = points[t+1];\n        var ov = {\n          x: p.x - o.x,\n          y: p.y - o.y\n        };\n        var rc = distanceFn ? distanceFn((t+1)/order) : d;\n        if(distanceFn && !clockwise) rc = -rc;\n        var m = sqrt(ov.x*ov.x + ov.y*ov.y);\n        ov.x /= m;\n        ov.y /= m;\n        np[t+1] = {\n          x: p.x + rc*ov.x,\n          y: p.y + rc*ov.y\n        }\n      }.bind(this));\n      return new Bezier(np);\n    },\n    outline: function(d1, d2, d3, d4) {\n      d2 = (typeof d2 === \"undefined\") ? d1 : d2;\n      var reduced = this.reduce(),\n          len = reduced.length,\n          order = this.order,\n          fcurves = [],\n          bcurves = [],\n          i, p, last,\n          alen = 0,\n          tlen = this.length();\n\n      var graduated = (typeof d3 !== \"undefined\" && typeof d4 !== \"undefined\");\n\n      function linearDistanceFunction(s,e, tlen,alen,slen) {\n        return function (v) {\n          var f1 = alen/tlen, f2 = (alen+slen)/tlen, d = e-s;\n          return utils.map(v, 0,1, s+f1*d, s+f2*d);\n        };\n      };\n\n      // form curve oulines\n      reduced.forEach(function(segment) {\n        slen = segment.length();\n        if (graduated) {\n          fcurves.push(segment.scale(  linearDistanceFunction( d1, d3, tlen,alen,slen)  ));\n          bcurves.push(segment.scale(  linearDistanceFunction(-d2,-d4, tlen,alen,slen)  ));\n        } else {\n          fcurves.push(segment.scale( d1));\n          bcurves.push(segment.scale(-d2));\n        }\n        alen += slen;\n      });\n\n      // reverse the \"return\" outline\n      bcurves = bcurves.map(function(s) {\n        p = s.points;\n        if(p[3]) { s.points = [p[3],p[2],p[1],p[0]]; }\n        else { s.points = [p[2],p[1],p[0]]; }\n        return s;\n      }).reverse();\n\n      // form the endcaps as lines\n      var fs = fcurves[0].points[0],\n          fe = fcurves[len-1].points[fcurves[len-1].points.length-1],\n          bs = bcurves[len-1].points[bcurves[len-1].points.length-1],\n          be = bcurves[0].points[0],\n          ls = utils.makeline(bs,fs),\n          le = utils.makeline(fe,be),\n          segments = [ls].concat(fcurves).concat([le]).concat(bcurves),\n          slen = segments.length;\n\n      return new PolyBezier(segments);\n    },\n    outlineshapes: function(d1,d2) {\n      d2 = d2 || d1;\n      var outline = this.outline(d1,d2).curves;\n      var shapes = [];\n      for(var i=1, len=outline.length; i < len/2; i++) {\n        var shape = utils.makeshape(outline[i], outline[len-i]);\n        shape.startcap.virtual = (i > 1);\n        shape.endcap.virtual = (i < len/2-1);\n        shapes.push(shape);\n      }\n      return shapes;\n    },\n    intersects: function(curve) {\n      if(!curve) return this.selfintersects();\n      if(curve.p1 && curve.p2) {\n        return this.lineIntersects(curve);\n      }\n      if(curve instanceof Bezier) { curve = curve.reduce(); }\n      return this.curveintersects(this.reduce(), curve);\n    },\n    lineIntersects: function(line) {\n      var mx = min(line.p1.x, line.p2.x),\n          my = min(line.p1.y, line.p2.y),\n          MX = max(line.p1.x, line.p2.x),\n          MY = max(line.p1.y, line.p2.y),\n          self=this;\n      return utils.roots(this.points, line).filter(function(t) {\n        var p = self.get(t);\n        return (mx <= p.x && p.x <= MX && my <= p.y && p.y <= MY);\n      });\n    },\n    selfintersects: function() {\n      var reduced = this.reduce();\n      // \"simple\" curves cannot intersect with their direct\n      // neighbour, so for each segment X we check whether\n      // it intersects [0:x-2][x+2:last].\n      var i,len=reduced.length-2,results=[],result,left,right;\n      for(i=0; i<len; i++) {\n        left = reduced.slice(i,i+1);\n        right = reduced.slice(i+2);\n        result = this.curveintersects(left, right);\n        results = results.concat( result );\n      }\n      return results;\n    },\n    curveintersects: function(c1,c2) {\n      var pairs = [];\n      // step 1: pair off any overlapping segments\n      c1.forEach(function(l) {\n        c2.forEach(function(r) {\n          if(l.overlaps(r)) {\n            pairs.push({ left: l, right: r });\n          }\n        });\n      });\n      // step 2: for each pairing, run through the convergence algorithm.\n      var intersections = [];\n      pairs.forEach(function(pair) {\n        var result = utils.pairiteration(pair.left, pair.right);\n        if(result.length > 0) {\n          intersections = intersections.concat(result);\n        }\n      });\n      return intersections;\n    }\n  };\n\n\n  if(typeof module !== \"undefined\" && module.exports) {\n    module.exports = Bezier;\n  }\n\n  else if(typeof define !== \"undefined\") {\n    define(function() { return Bezier; });\n  }\n\n  else if(typeof window !== \"undefined\") {\n    window.Bezier = Bezier;\n  }\n\n}());\n\n},{}]},{},[1]);\n"],"sourceRoot":"/source/"}